{{!-- Action Type --}}
<div class="form-group select">
  <label>{{localize "D35E.ActionType"}}</label>
  <select name="system.actionType">
    {{#select data.system.actionType}}
    <option value=""></option>
    {{#each config.itemActionTypes as |name type|}}
    <option value="{{type}}">{{name}}</option>
    {{/each}}
    {{/select}}
  </select>
</div>
{{#if data.system.actionType}}

{{#if isSpell}}
<div class="form-group">
  <label>{{localize "D35E.SpellEffect"}}</label>
  <div class="form-fields">
    <input type="text" name="system.spellEffect" value="{{data.system.spellEffect}}" placeholder="{{localize "D35E.SpellEffectExample"}}"/>
  </div>
</div>
{{/if}}
{{#unless isWeaponAttack}}
{{#if isConsumable}}
<div class="form-group">
  <label>{{localize "D35E.SpellLike"}}</label>
  <label class="checkbox" style="position: relative; flex: 0 20px">
    <input type="checkbox" class="stylized" name="system.isFromSpell" {{checked data.system.isFromSpell}}/>
    <span class="checkmark"></span>
  </label>
</div>
{{/if}}
{{#if isSpellLike}}
<div class="flexrow">
  <div class="form-group" style="flex: 1">
    <div class="toggle" style="width: 168px">
      <input id="{{randomUuid}}-data.spellData.metamagicFeats.good" type="checkbox" name="system.metamagicFeats.maximized" {{checked data.system.metamagicFeats.maximized}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.metamagicFeats.good">{{#if data.system.metamagicFeats.maximized}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellMaximized"}}</label>
    </div>
  </div>
  <div class="form-group" style="flex: 1">
    <div class="toggle" style="width: 168px">
      <input id="{{randomUuid}}-data.spellData.metamagicFeats.evil" type="checkbox" name="system.metamagicFeats.empowered" {{checked data.system.metamagicFeats.empowered}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.metamagicFeats.evil">{{#if data.system.metamagicFeats.empowered}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellEmpowered"}}</label>
    </div>
  </div>
  <div class="form-group" style="flex: 1">
    <div class="toggle" style="width: 168px">
      <input id="{{randomUuid}}-data.spellData.metamagicFeats.chaotic" type="checkbox" name="system.metamagicFeats.enlarged" {{checked data.system.metamagicFeats.enlarged}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.metamagicFeats.chaotic">{{#if data.system.metamagicFeats.enlarged}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellEnlarged"}}</label>
    </div>
  </div>
</div>
<div class="flexrow">
  <div class="form-group" style="flex: 1">
    <div class="toggle">
      <input id="{{randomUuid}}-data.spellData.metamagicFeats.lawful" type="checkbox" name="system.metamagicFeats.intensified" {{checked data.system.metamagicFeats.intensified}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.metamagicFeats.lawful">{{#if data.system.metamagicFeats.intensified}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellIntensified"}}</label>
    </div>
  </div>
  <div class="form-group" style="flex: 1">
    <div class="toggle">
      <input id="{{randomUuid}}-data.spellData.metamagicFeats.widened" type="checkbox" name="system.metamagicFeats.widened" {{checked data.system.metamagicFeats.widened}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.metamagicFeats.widened">{{#if data.system.metamagicFeats.widened}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellWidened"}}</label>
    </div>
  </div>
  <div class="form-group" style="flex: 1">
    <div class="toggle">
      <input id="{{randomUuid}}-data.spellData.metamagicFeats.enhanced" type="checkbox" name="system.metamagicFeats.enhanced" {{checked data.system.metamagicFeats.enhanced}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.metamagicFeats.enhanced">{{#if data.system.metamagicFeats.enhanced}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellEnhanced"}}</label>
    </div>
  </div>
</div>

<div class="form-group">
  <label>{{localize "D35E.SpellAttackCount"}}</label>
  <div class="form-fields">
    <input type="text" name="system.attackCountFormula" value="{{data.system.attackCountFormula}}" placeholder="{{localize "D35E.SpellAttackCountExample"}}"/>
  </div>
</div>
{{#unless isSpell}}
<div class="form-group">
  <label>{{localize "D35E.BaseSpellCL"}}</label>
  <div class="form-fields">
    <input type="text" name="system.baseCl" value="{{data.system.baseCl}}" placeholder="{{localize "D35E.BaseSpellCL"}}"/>
  </div>
</div>
<div class="flexrow">
  <div class="form-group" style="flex: 1">
    <div class="toggle">
      <input id="{{randomUuid}}-data.spellData.sr" type="checkbox" name="system.sr" {{checked data.system.sr}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.sr">{{#if data.system.sr}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.SpellResistance"}}</label>
    </div>
  </div>
  <div class="form-group" style="flex: 1">
    <div class="toggle">
      <input id="{{randomUuid}}-data.spellData.pr" type="checkbox" name="system.pr" {{checked data.system.pr}}/>
      <label style="width: 168px" for="{{randomUuid}}-data.spellData.pr">{{#if data.system.pr}}<i class="far fa-check-square"></i>{{else}}<i class="far fa-square"></i>{{/if}}{{localize "D35E.PowerResistance"}}</label>
    </div>
  </div>
  <span style="flex: 1">&nbsp;</span>
</div>

{{/unless}}
{{/if}}
{{/unless}}

{{#unless isAttack}}
<div class="form-group">
  <label class="tooltip">{{localize "D35E.MaxDamageDice"}}
    <span class="tooltipcontent">
      @item.maxDamageDice
    </span>
  </label>
  <div class="form-fields">
    <input type="text" name="system.maxDamageDiceFormula" value="{{data.system.maxDamageDiceFormula}}" placeholder="{{localize "D35E.SpellAttackCountExample"}}"/>
    <span style="flex: 0; margin-left: 8px">Total:</span>
    <input type="text" disabled value="{{data.system.maxDamageDice}}" placeholder="{{localize "D35E.SpellAttackCountExample"}}"/>
  </div>
</div>
{{/unless}}

{{!-- Attack Roll Bonus --}}
{{#if hasAttackRoll }}
<div class="form-group">
  <label>{{localize "D35E.AttackRollBonus"}}</label>
  <div class="form-fields">
    <input type="text" name="system.attackBonus" value="{{data.system.attackBonus}}" placeholder="{{localize "D35E.Formula"}}"/>
  </div>
</div>

<div class="form-group">
  <label>{{localize "D35E.CriticalThreatRange"}}</label>
  <div class="form-fields">
    <input type="text" name="system.ability.critRange" value="{{data.system.ability.critRange}}" placeholder="{{localize "D35E.Formula"}}"/>
  </div>
</div>

<div class="form-group">
  <label>{{localize "D35E.CriticalMultiplier"}}</label>
  <div class="form-fields">
    <input type="text" name="system.ability.critMult" value="{{data.system.ability.critMult}}" data-dtype="Number"/>
  </div>
</div>
<div class="form-group">
  <label>{{localize "D35E.CriticalConfirmBonus"}}</label>
  <div class="form-fields">
    <input type="text" name="system.critConfirmBonus" value="{{data.system.critConfirmBonus}}" placeholder="{{localize "D35E.Formula"}}"/>
  </div>
</div>

<div class="form-group">
  <label>{{localize "D35E.VsTouchAc"}}</label>
  <label class="checkbox" style="position: relative; flex: 0 20px">
    <input type="checkbox" class="stylized" name="system.ability.vsTouchAc" {{checked data.system.ability.vsTouchAc}}/>
    <span class="checkmark"></span>
  </label>
</div>
{{!-- Attack Ability --}}
<div class="form-group select">
  <label>{{localize "D35E.AttackAbility"}}</label>
  <select name="system.ability.attack">
    {{#select data.system.ability.attack}}
    <option value=""></option>
    {{#each config.abilities as |ability a|}}
    <option value="{{a}}">{{ability}}</option>
    {{/each}}
    {{/select}}
  </select>
</div>
{{#if notOnActor}}
<em style="opacity: 0.8;">
  This attack may behave differently when added to actor. Some of the features, like detecting auto scaling with BaB are disabled.
</em>
{{/if}}
{{#unless autoScaleWithBab}}
<h4 class="attack-header">
  {{localize "D35E.ExtraAttacks"}}
  <a class="attack-control add-attack"><i class="fas fa-plus"></i></a>
</h4>
<ol class="attack-parts form-group">
  {{#each data.system.attackParts as |part a|}}
  <li class="attack-part flexrow" data-attack-part="{{a}}">
    <input type="text" name="system.attackParts.{{a}}.0" placeholder="{{localize "D35E.AttackBonusFormula"}}" value="{{lookup this "0"}}"/>
    <input type="text" name="system.attackParts.{{a}}.1" placeholder="{{localize "D35E.Name"}}" value="{{lookup this "1"}}"/>
    <a class="attack-control delete-attack"><i class="fas fa-minus"></i></a>
  </li>
  {{/each}}
</ol>
{{else}}
<ol class="attack-parts form-group">
  <li class="attack-part flexrow">
    <h4 class="attack-header" style="flex: 1">
      {{localize "D35E.ExtraAttacks"}} <i class="fas fa-question-circle tooltip"><span class="tooltipcontent">{{{localize "D35E.NumberOfAttacksAutocalculated"}}}</span></i>
    </h4>
  <span style="flex: 1; text-align: end;">{{extraAttacksAuto}}<em>(Autocalculated)</em></span>
  </li>
</ol>
{{/unless}}
{{/if}}

{{!-- Damage Ability --}}
<div class="form-group select">
  <label>{{localize "D35E.DamageAbility"}}</label>
  <select name="system.ability.damage">
    {{#select data.system.ability.damage}}
    <option value=""></option>
    {{#each config.abilities as |ability a|}}
    <option value="{{a}}">{{ability}}</option>
    {{/each}}
    {{/select}}
  </select>
  <select name="system.ability.damageMult" data-dtype="Number">
    {{#select data.system.ability.damageMult}}
    {{#if isNaturalAttack}}
    <option value="-1">{{localize "D35E.Auto"}}</option>
    {{/if}}
    <option value="0.5">x0.5</option>
    <option value="1" {{#unless data.system.ability.damageMult}}selected="selected"{{/unless}}>x1</option>
    <option value="1.5">x1.5</option>
    <option value="2">x2</option>
    {{/select}}
  </select>
</div>

{{!-- Damage Formula --}}
<h4 class="damage-header">
  {{#unless isHealing }}{{localize "D35E.DamageFormula"}}{{ else }}{{localize "D35E.HealingFormula"}}{{/unless}}
  <a class="damage-control add-damage"><i class="fas fa-plus"></i></a>
</h4>
<ol class="damage-parts form-group tooltip">
  <span class="tooltipcontent">
    NOTE: Normally, every variable entered in these fields are not multiplied on a critical hit,
    EXCEPT the first damage die in the first field. If you want to have something multiplied on
    a critical hit, multiply it by the variable @critMult.<br>
    Examples:<br>
    1d8 + 2 * @critMult<br>
    2d6 + (@critMult)d6
  </span>
  {{#each data.system.damage.parts as |part i| }}
  <li class="damage-part flexrow" data-damage-part="{{i}}">
    <input type="text" name="system.damage.parts.{{i}}.0" placeholder="{{#unless isHealing }}{{localize "D35E.DamageFormula"}}{{ else }}{{localize "D35E.HealingFormula"}}{{/unless}}" value="{{lookup this "0"}}"/>
    <select name="system.damage.parts.{{i}}.2">
      {{#select (lookup this "2")}}
      <option value="">{{localize "D35E.Custom"}}</option>
      {{#each ../damageTypes as |damage type|}}
      <option value="{{damage.system.uniqueId}}">{{damage.name}} ({{damage.damageTypeString}})</option>
      {{/each}}
      {{/select}}
    </select>
    {{#unless (lookup this "2")}}
    <input type="text" name="system.damage.parts.{{i}}.1" value="{{lookup this "1"}}" placeholder="{{localize "D35E.DamageTypes"}}"/>
    {{/unless}}
    <a class="damage-control delete-damage"><i class="fas fa-minus"></i></a>
  </li>
  {{/each}}
</ol>

{{!-- Damage Formula --}}
<h4 class="damage-header">
  {{localize "D35E.AlternativeDamageFormula"}}
  <a class="damage-alt-control add-alt-damage"><i class="fas fa-plus"></i></a>
</h4>
<ol class="damage-parts form-group tooltip">
  <span class="tooltipcontent">
    This damage is not affected by crtical hits or other modifiers automatically.
  </span>
  {{#each data.system.damage.alternativeParts as |part i| }}
  <li class="damage-part flexrow" data-damage-part="{{i}}">
    <input type="text" name="system.damage.alternativeParts.{{i}}.0" placeholder="{{#unless isHealing }}{{localize "D35E.DamageFormula"}}{{ else }}{{localize "D35E.HealingFormula"}}{{/unless}}" value="{{lookup this "0"}}"/>
    <select name="system.damage.alternativeParts.{{i}}.2">
      {{#select (lookup this "2")}}
      <option value="">{{localize "D35E.Custom"}}</option>
      {{#each ../damageTypes as |damage type|}}
      <option value="{{damage.system.uniqueId}}">{{damage.name}}</option>
      {{/each}}
      {{/select}}
    </select>
    {{#unless (lookup this "2")}}
    <input type="text" name="system.damage.alternativeParts.{{i}}.1" value="{{lookup this "1"}}" placeholder="{{localize "D35E.DamageTypes"}}"/>
    {{/unless}}
    <a class="damage-alt-control delete-alt-damage"><i class="fas fa-minus"></i></a>
  </li>
  {{/each}}
</ol>

{{!-- Saving Throw --}}
{{#unless isSpell}}
<div class="form-group input-select">
  <label>{{localize "D35E.UseAutoDC"}}</label>
  <div class="form-fields">
    <select name="system.save.dcAutoType">
      {{#select data.system.save.dcAutoType}}
      <option value="">{{localize "D35E.Disable"}}</option>
      {{#each config.savingThrowCalculationTypes as |saveType type|}}
      <option value="{{type}}">{{saveType}}</option>
      {{/each}}
      {{/select}}
    </select>
    {{#unless data.system.save.dcAutoType}}
    
    {{else}}
    <span style="flex: 0;">+</span>
    <select name="system.save.dcAutoAbility">
      {{#select data.system.save.dcAutoAbility}}
      <option value="">{{localize "D35E.NoAbility"}}</option>
      {{#each config.abilities as |ability type|}}
      <option value="{{type}}">{{ability}}</option>
      {{/each}}
      {{/select}}
    </select>
    {{/unless}}
  </div>
</div>
{{/unless}}
<div class="form-group input-select">
  <label>{{#unless isSpell}}{{localize "D35E.DC"}}{{else}}{{localize "D35E.DCOffset"}}{{/unless}}</label>
  <div class="form-fields">
    <input type="text" {{#if data.system.save.dcAutoType}}disabled class="readonly"{{/if}} name="system.save.dc" value="{{data.system.save.dc}}" placeholder="{{#unless isSpell}}{{localize "D35E.DC"}}{{else}}{{localize "D35E.DCOffset"}}{{/unless}}"/>
    <select name="system.save.type">
      {{#select data.system.save.type}}
      <option value="">{{localize "D35E.Custom"}}</option>
      {{#each config.savingThrowTypes as |saveType type|}}
      <option value="{{type}}">{{saveType}}</option>
      {{/each}}
      {{/select}}
    </select>
    {{#unless data.system.save.type}}
    <input type="text" name="system.save.description" value="{{data.system.save.description}}" placeholder="{{localize "D35E.DCDescriptionExample"}}"/>
    {{else}}
    <select name="system.save.ability">
      {{#select data.system.save.ability}}
      <option value="">{{localize "D35E.Default"}}</option>
      {{#each config.abilities as |ability type|}}
      <option value="{{type}}">{{ability}}</option>
      {{/each}}
      {{/select}}
    </select>
    {{/unless}}



  </div>
</div>






{{!-- Attack Notes --}}
<div class="form-group stacked">
  <label>{{localize "D35E.AttackNotes"}}</label>
  <textarea type="text" name="system.attackNotes">{{data.system.attackNotes}}</textarea>
</div>

{{!-- Effect Notes --}}
<div class="form-group stacked">
  <label>{{localize "D35E.EffectNotes"}}</label>
  <textarea type="text" name="system.effectNotes" style="white-space: pre">{{data.system.effectNotes}}</textarea>
</div>


<div class="flexcol summons">
  <h4 class="in-header">
    {{localize "D35E.Summons"}}
  </h4>
  <ol class="summons-parts form-group">
    {{#each data.system.summon as |part a|}}
    <li class="summons-part flexcol" data-summons="{{a}}">
      <h4><b>{{lookup this "name"}}</b> <span style="float: right">{{localize "D35E.LinkedRolltable"}} {{lookup this "id"}} <a class="colorized-link summons-control delete-summons">{{localize "D35E.UnlinkRolltable"}}</a></span></h4>
      <div class="flexrow"><span>Formula:</span><input type="text" name="system.summon.{{a}}.formula" placeholder="{{localize "D35E.Formula"}}" value="{{lookup this "formula"}}"/></div>
      <input type="hidden" name="system.summon.{{a}}.id" value="{{lookup this "id"}}">
      <input type="hidden" name="system.summon.{{a}}.pack" value="{{lookup this "pack"}}">
      <input type="hidden" name="system.summon.{{a}}.name" value="{{lookup this "name"}}">
    </li>
    {{/each}}
  </ol>
  <div class="summons-link flexcol">
    <div style="width: 100%; text-align: center; padding: 12px">
      你可以从合集中拖来一个随机表以创建一个召唤特殊行动。
    </div>
  </div>
</div>

<div class="flexcol special-actions">
  <h4 class="in-header">
    {{localize "D35E.SpecialActions"}}
    <a class="special-control add-special"><i class="fas fa-plus"></i>创建</a>
    <a class="special-control add-special-template"><i class="fas fa-plus"></i>用模板创建</a>
  </h4>
  <ol class="special-parts form-group">
    {{#each data.system.specialActions as |part a|}}
    <li class="special-part flexcol" data-special-actions="{{a}}">
      <div class="flexrow"><span>Name:</span><input type="text" name="system.specialActions.{{a}}.name" placeholder="{{localize "D35E.Name"}}" value="{{lookup this "name"}}"/></div>
      <div class="flexrow"><span>Action:</span><input type="text" name="system.specialActions.{{a}}.action" placeholder="{{localize "D35E.Action"}}" value="{{lookup this "action"}}"/></div>
      <div class="flexrow"><span>Condition:</span><input type="text" name="system.specialActions.{{a}}.condition" placeholder="{{localize "D35E.Condition"}}" value="{{lookup this "condition"}}"/></div>
      <div class="flexrow"><span>Icon path:</span><input type="text" name="system.specialActions.{{a}}.img" placeholder="{{localize "D35E.Image"}}" value="{{lookup this "img"}}"/></div>
      <div style="width: 100%">
      <a class="special-control delete-special" style="width: auto; float: right"><i class="fas fa-minus"></i>Remove</a>
      </div>
    </li>
    {{/each}}
  </ol>
  <div class="spellbuff-link flexcol">
    <div style="width: 100%; text-align: center; padding: 12px">
      从合集中拖来一个状态以快捷地创建一个特殊行动。
    </div>
  </div>
</div>

<h4 class="in-header">
  {{localize "D35E.RollTableDraw"}}
</h4>
<div class="form-group">
  <label>{{localize "D35E.RollTableDrawFormula"}}</label>
  <input type="text" name="system.rollTableDraw.formula"  value="{{data.system.rollTableDraw.formula}}">
</div>
<div class="rolltable-link flexcol">
  {{#unless data.system.rollTableDraw.id}}
  <div style="width: 100%; text-align: center; padding: 12px">
    {{localize "D35E.DropRolltable"}}
  </div>
  {{else}}
  <h4>{{localize "D35E.LinkedRolltable"}} {{data.system.rollTableDraw.id}}<a style="float: right" class="colorized-link remove-rolltable-link">{{localize "D35E.UnlinkRolltable"}}</a></h4>
  <div class="form-group">
    <label>{{data.system.rollTableDraw.name}}</label>
  </div>
  {{/unless}}
</div>
{{/if}}
